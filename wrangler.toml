name = "ohmyphoto"
main = "src/worker.js"
compatibility_date = "2025-12-20"

[vars]
# Workers AI model for album-id generation (override in your environment if needed).
# Examples you can try: "@cf/meta/llama-3.1-8b-instruct", "@cf/meta/llama-2-7b-chat-int8"
AI_ALBUM_ID_MODEL = "@cf/meta/llama-2-7b-chat-int8"
# Speed/format knobs (optional)
AI_ALBUM_ID_MAX_TOKENS = "16"
AI_ALBUM_ID_TEMPERATURE = "0.2"

[assets]
binding = "ASSETS"
directory = "./public"
not_found_handling = "single-page-application"
run_worker_first = ["/api/*", "/img/*"]

[build]
command = "node scripts/build-assets.mjs"
watch_dir = "src/client"

[[r2_buckets]]
binding = "BUCKET"
bucket_name = "ohmyphoto"

[[durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiterDO"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["RateLimiterDO"]

[[migrations]]
tag = "v2"
new_sqlite_classes = ["AlbumIndexDO"]

[[durable_objects.bindings]]
name = "ALBUM_INFO"
class_name = "AlbumInfoDO"

[[migrations]]
tag = "v3"
new_sqlite_classes = ["AlbumInfoDO"]

[[migrations]]
tag = "v4"
deleted_classes = ["AlbumIndexDO"]

[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
invocation_logs = true
persist = true
head_sampling_rate = 1

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1

[ai]
binding = "AI"