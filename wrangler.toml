name = "ohmyphoto"
main = "src/worker.js"
compatibility_date = "2025-12-20"

[assets]
binding = "ASSETS"
directory = "./public"
not_found_handling = "single-page-application"
run_worker_first = ["/api/*", "/img/*"]

[build]
command = "node scripts/build-assets.mjs"
watch_dir = "src/client"

[[r2_buckets]]
binding = "BUCKET"
bucket_name = "ohmyphoto"

[[durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiterDO"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["RateLimiterDO"]

[[durable_objects.bindings]]
name = "ALBUM_INDEXER"
class_name = "AlbumIndexDO"

[[migrations]]
tag = "v2"
new_sqlite_classes = ["AlbumIndexDO"]

[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
invocation_logs = true
persist = true
head_sampling_rate = 1

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1